
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pydistort.zernike_distortion &#8212; pydistort 2.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=f5cff4aa"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pydistort/zernike_distortion';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pydistort 2.0.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pydistort.zernike_distortion</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pydistort.zernike_distortion</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Number</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyzernike</span><span class="w"> </span><span class="kn">import</span> <span class="n">xy_zernike_polynomial_up_to_order</span><span class="p">,</span> <span class="n">zernike_order_to_index</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.objects.distortion</span><span class="w"> </span><span class="kn">import</span> <span class="n">Distortion</span><span class="p">,</span> <span class="n">DistortionResult</span>


<div class="viewcode-block" id="ZernikeDistortion">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ZernikeDistortion</span><span class="p">(</span><span class="n">Distortion</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to apply distortion with a Zernike polynomial model.</span>

<span class="sd">    Distort the given ``normalized_points`` using the distortion model to obtain the ``distorted_points``.</span>

<span class="sd">    .. math::</span>

<span class="sd">        x_D = \text{distort}(x_N, \lambda_1, \lambda_2, \lambda_3, \ldots)</span>

<span class="sd">    The distorted points can be calculated using the normalized points and the Zernike coefficients as follows:</span>

<span class="sd">    .. math::</span>

<span class="sd">        x_{D} = x_{N} + \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{x}_{n,m} Z_{nm}(\rho, \theta)</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_{D} = y_{N} + \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{y}_{n,m} Z_{nm}(\rho, \theta)</span>

<span class="sd">    where :math:`Z_{nm}(\rho, \theta)` are the Zernike polynomials, :math:`C^{x}_{n,m}` and :math:`C^{y}_{n,m}` are the</span>
<span class="sd">    Zernike coefficients for the x and y coordinates, respectively, and :math:`\rho` and :math:`\theta` are the</span>
<span class="sd">    polar coordinates of the normalized points in the defined unit ellipse with radius :math:`R_x, R_y` and center :math:`(x_0, y_0)`:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \rho = \sqrt{\left(\frac{x_{N} - x_{0}}{R_x}\right)^2 + \left(\frac{y_{N} - y_{0}}{R_y}\right)^2}</span>

<span class="sd">    .. math::</span>

<span class="sd">        \theta = \arctan2(y_{N} - y_{0}, x_{N} - x_{0})</span>

<span class="sd">    .. note::</span>

<span class="sd">        For more informations about Zernike polynomials, see the package pyzernike (https://github.com/Artezaru/pyzernike).</span>

<span class="sd">    Only coeffcients for :math:`n \leq N_{zer}` and :math:`m \in [-n, n]` and :math:`n-m \equiv 0 \mod 2` are stored.</span>

<span class="sd">    The coefficients are storred in a ``parameters`` 1D-array with the OSA/ANSI standard indices but with a x/y separation:</span>

<span class="sd">    - C^{x}_{0,0}, parameters[0] for the x coordinate :math:`n=0, m=0`</span>
<span class="sd">    - C^{y}_{0,0}, parameters[1] for the y coordinate :math:`n=0, m=0`</span>
<span class="sd">    - C^{x}_{1,-1}, parameters[2] for the x coordinate :math:`n=1, m=-1`</span>
<span class="sd">    - C^{y}_{1,-1}, parameters[3] for the y coordinate :math:`n=1, m=-1`</span>
<span class="sd">    - C^{x}_{1,1}, parameters[4] for the x coordinate :math:`n=1, m=1`</span>
<span class="sd">    - C^{y}_{1,1}, parameters[5] for the y coordinate :math:`n=1, m=1`</span>
<span class="sd">    - C^{x}_{2,-2}, parameters[6] for the x coordinate :math:`n=2, m=-2`</span>
<span class="sd">    - C^{y}_{2,-2}, parameters[7] for the y coordinate :math:`n=2, m=-2`</span>
<span class="sd">    - C^{x}_{2,0}, parameters[8] for the x coordinate :math:`n=2, m=0`</span>
<span class="sd">    - C^{y}_{2,0}, parameters[9] for the y coordinate :math:`n=2, m=0`</span>
<span class="sd">    - C^{x}_{2,2}, parameters[10] for the x coordinate :math:`n=2, m=2`</span>
<span class="sd">    - C^{y}_{2,2}, parameters[11] for the y coordinate :math:`n=2, m=2`</span>
<span class="sd">    - ...</span>

<span class="sd">    If the number of input parameters is not equal to the number of parameters required by the model, the other parameters are set to 0.</span>

<span class="sd">    The number of parameters is given by the formula:</span>

<span class="sd">    .. math::</span>

<span class="sd">        N_{params} = (N_{zer}+1)(N_{zer}+2)</span>

<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | Ordre of Zernike ``Nzer`` | Nparameters for X or Y          | Nparameters in model ``Nparams``    |</span>
<span class="sd">    +===========================+=================================+=====================================+</span>
<span class="sd">    | None                      | 0                               | 0                                   |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | 0                         | 1                               | 2                                   |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | 1                         | 3                               | 6                                   |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | 2                         | 6                               | 12                                  |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | 3                         | 10                              | 20                                  |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>
<span class="sd">    | 4                         | 15                              | 30                                  |</span>
<span class="sd">    +---------------------------+---------------------------------+-------------------------------------+</span>

<span class="sd">    .. warning::</span>

<span class="sd">        If the ordre of the zernike polynomials ``Nzer`` is given during instantiation, the given parameters are truncated or extended to the given number of parameters. Same for the number of parameters ``Nparams``.</span>

<span class="sd">    To compute the Distortion, the user must define the unit circle in which the normalized points are defined.</span>
<span class="sd">    The unit circle is defined by the radius :math:`R` and the center :math:`(x_{0}, y_{0})`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : numpy.ndarray, optional</span>
<span class="sd">        The parameters of the distortion model. If None, no distortion is applied. The default is None.</span>

<span class="sd">    Nzer : int, optional</span>
<span class="sd">        The order of the Zernike polynomials. If None, the order is set according to the number of parameters. The default is None.</span>
<span class="sd">        Only use ``Nzer`` or ``Nparams``, not both.</span>

<span class="sd">    Nparams : int, optional</span>
<span class="sd">        The number of parameters of the distortion model. If None, the number of parameters is set according to the order of the Zernike polynomials. The default is None.</span>
<span class="sd">        Only use ``Nzer`` or ``Nparams``, not both.</span>

<span class="sd">    radius : float, optional</span>
<span class="sd">        The radius of the unit circle in which the normalized points are defined. If None, the radius is set to 1.0. The default is None.</span>
<span class="sd">        This radius is used to normalize the points in the unit circle. If given, ``radius_x`` and ``radius_y`` must be None.</span>

<span class="sd">    radius_x : float, optional</span>
<span class="sd">        The radius of the unit ellipse in which the normalized points are defined along x-axis. If None, the radius is set to 1.0. The default is None.</span>

<span class="sd">    radius_y : float, optional</span>
<span class="sd">        The radius of the unit ellipse in which the normalized points are defined along y-axis. If None, the radius is set to 1.0. The default is None.</span>

<span class="sd">    center : Tuple[float, float], optional</span>
<span class="sd">        The center of the unit circle in which the normalized points are defined. If None, the center is set to (0.0, 0.0). The default is None.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Create an distortion object with a given model:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        from pydistort import ZernikeDistortion</span>

<span class="sd">        # Create a distortion object with 8 parameters</span>
<span class="sd">        distortion = ZernikeDistortion(np.array([0.1, 0.2, 0.3, 0.4, 0.5, 0.6])) # Model with Nzer=1, -&gt; Nparams=6</span>

<span class="sd">    Then you can use the distortion object to distort ``normalized_points``:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        normalized_points = np.array([[0.1, 0.2],</span>
<span class="sd">                                       [0.3, 0.4],</span>
<span class="sd">                                       [0.5, 0.6]]) # shape (3, 2)</span>

<span class="sd">        result = distortion.transform(normalized_points): #alias distort is also available</span>
<span class="sd">        distorted_points = result.distorted_points # shape (3, 2) -&gt; distorted points in (normalized) image coordinates</span>
<span class="sd">        print(distorted_points)</span>

<span class="sd">    You can also access to the jacobian of the distortion transformation:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        result = distortion.transform(distorted_points, dx=True, dp=True)</span>
<span class="sd">        distorted_points_dx = result.jacobian_dx  # Jacobian of the image points with respect to the distorted points # Shape (..., 2, 3)</span>
<span class="sd">        distorted_points_dp = result.jacobian_dp  # Jacobian of the image points with respect to the intrinsic parameters # Shape (..., 2, Nparams)</span>

<span class="sd">    The parameters are ordered as given in the model description above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Nzer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">radius_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">radius_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Nzer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only use Nzer or Nparams, not both.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">=</span> <span class="n">Nparams</span>
        <span class="k">if</span> <span class="n">Nzer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span> <span class="o">=</span> <span class="n">Nzer</span>
        
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">radius_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">radius_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If radius is given, radius_x and radius_y must be None.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">radius_x</span> <span class="o">=</span> <span class="n">radius</span>
            <span class="n">radius_y</span> <span class="o">=</span> <span class="n">radius</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radius_x</span> <span class="o">=</span> <span class="n">radius_x</span> <span class="k">if</span> <span class="n">radius_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_y</span> <span class="o">=</span> <span class="n">radius_y</span> <span class="k">if</span> <span class="n">radius_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span> <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parameters</span>
    <span class="c1"># =================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the parameters of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            The parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the parameters of the distortion model.</span>
<span class="sd">        If None, no distortion is applied.</span>

<span class="sd">        The number of parameters should be a 1D numpy array with a size in [None, 2, 6, 12, 20, 30, ...].</span>

<span class="sd">        .. math::</span>

<span class="sd">            N_{params} = (N_{zer}+1)(N_{zer}+2)</span>

<span class="sd">        If the number of input parameters is not equal to the number of parameters required by the model, the other parameters are set to 0.</span>

<span class="sd">        The parameters are set in the following order:</span>

<span class="sd">        - N = 0 parameters : similar than None</span>
<span class="sd">        - N = 2 parameters : :math:`C^{x}_{0,0}, C^{y}_{0,0}` : Zernike coefficients for the x and y coordinates with order 0</span>
<span class="sd">        - N = 6 parameters : :math:`C^{x}_{0,0}, C^{y}_{0,0}, C^{x}_{1,-1}, C^{y}_{1,-1}, C^{x}_{1,1}, C^{y}_{1,1}` : Zernike coefficients for the x and y coordinates with order 0 and 1</span>
<span class="sd">        - N = 12 parameters : :math:`C^{x}_{0,0}, C^{y}_{0,0}, C^{x}_{1,-1}, C^{y}_{1,-1}, C^{x}_{1,1}, C^{y}_{1,1}, C^{x}_{2,-2}, C^{y}_{2,-2}, C^{x}_{2,0}, C^{y}_{2,0}, C^{x}_{2,2}, C^{y}_{2,2}` : Zernike coefficients for the x and y coordinates with order 0, 1 and 2</span>
<span class="sd">        - N = 20 parameters : ...</span>

<span class="sd">        To easily use the parameters, you can use the methods ``get_Cx``, ``set_Cx``, ``get_Cy`` and ``set_Cy`` to get and set the Zernike coefficients for the x and y coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameters : numpy.ndarray, optional</span>
<span class="sd">            The parameters of the distortion model. If None, no distortion is applied. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the parameters is not a 1D numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The parameters should be a 1D numpy array.&quot;</span><span class="p">)</span>
            <span class="c1"># Extend the number of parameters to a valid number</span>
            <span class="n">Nzer</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">Nzer</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">Nparams</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Extend the parameters to the next valid size</span>
            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">parameters</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nparams</span> <span class="o">-</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>
            <span class="c1"># Set to None if the number of parameters is 0</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nparams</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of parameters of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">size</span>
        
    <span class="nd">@Nparams</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Integral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the number of parameters of the distortion model.</span>
<span class="sd">        </span>
<span class="sd">        The given number of parameters must be in [0, 2, 6, 12, 20, 30, ...].</span>

<span class="sd">        .. math::</span>

<span class="sd">            N_{params} = (N_{zer}+1)(N_{zer}+2)</span>

<span class="sd">        If the given number of parameters is less than the current number of parameters, the parameters are truncated.</span>
<span class="sd">        If the given number of parameters is greater than the current number of parameters, the parameters are extended with zeros.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The number of parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The number of parameters should be an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters should be a non-negative integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        
        <span class="n">Nzer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">Nzer</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Check if the number of parameters is valid</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters should be in [0, 2, 6, 12, 20, 30, ...].&quot;</span><span class="p">)</span>
        
        <span class="c1"># If parameters is None, create a new array of zeros</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">)))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nzer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the order of the Zernike polynomials.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[Integral]</span>
<span class="sd">            The order of the Zernike polynomials. If no distortion is applied, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">Nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span>
        <span class="n">Nzer</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Nparams</span><span class="p">:</span>
            <span class="n">Nzer</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">Nzer</span>
    
    <span class="nd">@Nzer</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nzer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Integral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the order of the Zernike polynomials.</span>

<span class="sd">        The given order must be in [0, 1, 2, 3, 4, ...].</span>

<span class="sd">        If the given order is less than the current order, the parameters are truncated.</span>
<span class="sd">        If the given order is greater than the current order, the parameters are extended with zeros.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The order of the Zernike polynomials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The order of the Zernike polynomials should be an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The order of the Zernike polynomials should be a non-negative integer.&quot;</span><span class="p">)</span>
        
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the radius of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The radius of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_radius_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The radius_x and radius_y should be the same for the unit circle. Please set the same value for both or use radius_x and radius_y separately for ellipses.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_x</span>
    
    <span class="nd">@radius</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the radius of the unit circle in which the normalized points are defined.</span>

<span class="sd">        The value will be propagated to both `radius_x` and `radius_y`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The radius of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The radius should be a float or an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The radius should be a positive number.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the radius of the unit ellipse in which the normalized points are defined along x-axis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The radius of the unit ellipse along x-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_x</span>
    
    <span class="nd">@radius_x</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the radius of the unit ellipse in which the normalized points are defined along x-axis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The radius of the unit ellipse along x-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The radius_x should be a float or an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The radius_x should be a positive number.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the radius of the unit ellipse in which the normalized points are defined along y-axis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The radius of the unit ellipse along y-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius_y</span>
    
    <span class="nd">@radius_y</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">radius_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the radius of the unit ellipse in which the normalized points are defined along y-axis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The radius of the unit ellipse along y-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The radius_y should be a float or an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The radius_y should be a positive number.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius_y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            The center of the unit circle as a 1D array with two elements (x, y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
    <span class="nd">@center</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : numpy.ndarray</span>
<span class="sd">            The center of the unit circle as a 1D array with two elements (x, y).</span>
<span class="sd">            The array should be of shape (2,) and of type float or int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The center should be a 1D array with two elements (x, y).&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The center coordinates should be finite numbers.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">x0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the x coordinate of the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The x coordinate of the center of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@x0</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">x0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the x coordinate of the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The x coordinate of the center of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The x0 should be a float or an integer.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">y0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the y coordinate of the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The y coordinate of the center of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@y0</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the y coordinate of the center of the unit circle in which the normalized points are defined.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The y coordinate of the center of the unit circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The y0 should be a float or an integer.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Distortion Model Coefficients</span>
    <span class="c1"># =================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Zernike coefficients for the x coordinate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[numpy.ndarray]</span>
<span class="sd">            The Zernike coefficients for the x coordinate. If no distortion is applied, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="nd">@parameters_x</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Zernike coefficients for the x coordinate.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The value must be a 1D numpy array with the same number of elements as the number of parameters requested by the model.</span>
<span class="sd">            Use ``parameters``, ``Nzer`` or ``Nparams`` to change the model !</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : numpy.ndarray</span>
<span class="sd">            The Zernike coefficients for the x coordinate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No distortion model is defined. Set the parameters first.&quot;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The Zernike coefficients for the x coordinate should be a 1D numpy array.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The number of Zernike coefficients for the x coordinate should be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The Zernike coefficients for the x coordinate should be finite numbers.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Zernike coefficients for the y coordinate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[numpy.ndarray]</span>
<span class="sd">            The Zernike coefficients for the y coordinate. If no distortion is applied, returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="nd">@parameters_y</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Zernike coefficients for the y coordinate.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The value must be a 1D numpy array with the same number of elements as the number of parameters requested by the model.</span>
<span class="sd">            Use ``parameters``, ``Nzer`` or ``Nparams`` to change the model !</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : numpy.ndarray</span>
<span class="sd">            The Zernike coefficients for the y coordinate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No distortion model is defined. Set the parameters first.&quot;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The Zernike coefficients for the y coordinate should be a 1D numpy array.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The number of Zernike coefficients for the y coordinate should be </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The Zernike coefficients for the y coordinate should be finite numbers.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Methods to set and get the coefficients</span>
    <span class="c1"># =================================================================</span>
<div class="viewcode-block" id="ZernikeDistortion.get_index">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.get_index">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of the Zernike coefficient for the given order and azimuthal frequency.</span>

<span class="sd">        .. math::</span>

<span class="sd">            j = n(n+2) + m + (0 \text{ if } coord = &#39;x&#39; \text{ else } 1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The order of the Zernike polynomial.</span>
<span class="sd">        m : int</span>
<span class="sd">            The azimuthal frequency of the Zernike polynomial.</span>
<span class="sd">        coord : str</span>
<span class="sd">            The coordinate (&#39;x&#39; or &#39;y&#39;) for which to get the index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The index of the Zernike coefficient in the parameters array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The coordinate should be &#39;x&#39; or &#39;y&#39;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integral</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The order and azimuthal frequency should be integers.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid order or azimuthal frequency for Zernike polynomial.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No distortion model is defined.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The order of the Zernike polynomial </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is greater than the defined order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        
        <span class="n">index</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">m</span>
        <span class="k">if</span> <span class="n">coord</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">index</span></div>

        
<div class="viewcode-block" id="ZernikeDistortion.set_Cx">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.set_Cx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_Cx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Zernike coefficient for the x coordinate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The order of the Zernike polynomial.</span>
<span class="sd">        m : int</span>
<span class="sd">            The azimuthal frequency of the Zernike polynomial.</span>
<span class="sd">        value : float</span>
<span class="sd">            The value of the Zernike coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ZernikeDistortion.get_Cx">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.get_Cx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_Cx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">Integral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Number</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Zernike coefficient for the x coordinate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The order of the Zernike polynomial.</span>
<span class="sd">        m : int</span>
<span class="sd">            The azimuthal frequency of the Zernike polynomial.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The value of the Zernike coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>

        
<div class="viewcode-block" id="ZernikeDistortion.set_Cy">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.set_Cy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_Cy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Zernike coefficient for the y coordinate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The order of the Zernike polynomial.</span>
<span class="sd">        m : int</span>
<span class="sd">            The azimuthal frequency of the Zernike polynomial.</span>
<span class="sd">        value : float</span>
<span class="sd">            The value of the Zernike coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ZernikeDistortion.get_Cy">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.get_Cy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_Cy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">Integral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Number</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the Zernike coefficient for the y coordinate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            The order of the Zernike polynomial.</span>
<span class="sd">        m : int</span>
<span class="sd">            The azimuthal frequency of the Zernike polynomial.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The value of the Zernike coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>


    <span class="c1"># =================================================================</span>
    <span class="c1"># Display the distortion model</span>
    <span class="c1"># =================================================================</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The string representation of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ZernikeDistortion: No distortion model&quot;</span>
        
        <span class="n">Nzer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span>
        <span class="n">Nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span>
        <span class="n">parameters_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ZernikeDistortion: </span><span class="si">{</span><span class="n">Nparams</span><span class="si">}</span><span class="s2"> parameters (Nzer=</span><span class="si">{</span><span class="n">Nzer</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">parameters_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  Cx[n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, m=</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">)]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">parameters_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  Cy[n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">, m=</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">)]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">parameters_str</span>
            

    <span class="c1"># =================================================================</span>
    <span class="c1"># Implementation of the abstract methods</span>
    <span class="c1"># =================================================================</span>
<div class="viewcode-block" id="ZernikeDistortion.is_set">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion.is_set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the distortion model is set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the distortion model is set, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The distortion model is always set (Nparams = 0 just means no distortion)</span>
        <span class="k">return</span> <span class="kc">True</span> </div>

    

<div class="viewcode-block" id="ZernikeDistortion._transform">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion._transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.objects.Transform.transform` method to perform the distortion transformation.</span>
<span class="sd">        This method allows to transform the ``normalized_points`` to the ``distorted_points`` using the distortion model.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_transform`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) for the image points and (Npoints, 2, 2) for the jacobian with respect to the normalized points and (Npoints, 2, 4) for the jacobian with respect to the distortion parameters.</span>

<span class="sd">        The equation used for the transformation is given in the main documentation of the class.</span>

<span class="sd">        We have (only for the x coordinate):</span>

<span class="sd">        .. math::</span>

<span class="sd">            x_{D} = x_{N} + \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{x}_{n,m} Z_{nm}(\rho, \theta)</span>

<span class="sd">        .. math::</span>

<span class="sd">            x_{D} = x_{N} + \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{x}_{n,m} Z_{nm}(\sqrt{\left(\frac{x_{N} - x_{0}}{R_x}\right)^2 + \left(\frac{y_{N} - y_{0}}{R_y}\right)^2}, \arctan2(\frac{y_{N} - y_{0}}{R_y}, \frac{x_{N} - x_{0}}{R_x})))</span>

<span class="sd">        The derivative of the distorted points with respect to the normalized points is given by:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial x_{D}}{\partial x_{N}} = 1 + \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{x}_{n,m} \frac{\partial Z_{nm}}{\partial x_{N}}</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial x_{D}}{\partial y_{N}} = \sum_{n=0}^{N_{zer}} \sum_{m=-n}^{n} C^{x}_{n,m} \frac{\partial Z_{nm}}{\partial y_{N}}</span>

<span class="sd">        Where:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial Z_{nm}}{\partial x_{N}} = \frac{\partial Z_{nm}}{\partial \rho} \cdot \frac{\partial \rho}{\partial x_{N}} + \frac{\partial Z_{nm}}{\partial \theta} \cdot \frac{\partial \theta}{\partial x_{N}}</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial Z_{nm}}{\partial y_{N}} = \frac{\partial Z_{nm}}{\partial \rho} \cdot \frac{\partial \rho}{\partial y_{N}} + \frac{\partial Z_{nm}}{\partial \theta} \cdot \frac{\partial \theta}{\partial y_{N}}</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            Package ``pyzernike`` (https://github.com/Artezaru/pyzernike) for the implementation of the Zernike polynomials and their derivatives.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            Array of normalized points to be transformed with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            If True, the Jacobian of the distorted points with respect to the normalized points is computed. Default is False.</span>
<span class="sd">            The output will be a 2D array of shape (Npoints, 2, 2).</span>

<span class="sd">        dp : bool, optional</span>
<span class="sd">            If True, the Jacobian of the distorted points with respect to the distortion parameters is computed. Default is False.</span>
<span class="sd">            The output will be a 2D array of shape (Npoints, 2, Nparams).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            The transformed distorted points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            The Jacobian of the distorted points with respect to the normalized points if ``dx`` is True. Otherwise None.</span>
<span class="sd">            It will be a 2D array of shape (Npoints, 2, 2).</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            The Jacobian of the distorted points with respect to the distortion parameters if ``dp`` is True. Otherwise None.</span>
<span class="sd">            It will be a 2D array of shape (Npoints, 2, Nparams).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare the inputs data for distortion</span>
        <span class="n">x_N</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">y_N</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">Nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span>

        <span class="c1"># Prepare the output jacobian arrays</span>
        <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
            <span class="n">jacobian_dx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="p">(</span><span class="n">x_N</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># shape (Npoints, 2, 2)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jacobian_dx</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">jacobian_dp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">x_N</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jacobian_dp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If no distortion model is defined, return the normalized points</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">normalized_points</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">jacobian_dx</span><span class="p">,</span> <span class="n">jacobian_dp</span>
        
        <span class="c1"># Initialize the distorted points</span>
        <span class="n">x_D</span> <span class="o">=</span> <span class="n">x_N</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">y_D</span> <span class="o">=</span> <span class="n">y_N</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Construct the derivatives to compute the Jacobian</span>
        <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
            <span class="n">list_dx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">list_dy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_dx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">list_dy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
        <span class="c1"># Construct the zernike polynomial values and their derivatives</span>
        <span class="n">zernike_results</span> <span class="o">=</span> <span class="n">xy_zernike_polynomial_up_to_order</span><span class="p">(</span><span class="n">x_N</span><span class="p">,</span> <span class="n">y_N</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span><span class="p">,</span> <span class="n">Rx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_x</span><span class="p">,</span> <span class="n">Ry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">radius_y</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_derivative</span><span class="o">=</span><span class="n">list_dx</span><span class="p">,</span> <span class="n">y_derivative</span><span class="o">=</span><span class="n">list_dy</span><span class="p">)</span>

        <span class="c1"># Initialize the distorted points and jacobians</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nzer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">zernike_index</span> <span class="o">=</span> <span class="n">zernike_order_to_index</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">m</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Get the Zernike polynomial value</span>
                <span class="n">Z_nm</span> <span class="o">=</span> <span class="n">zernike_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">zernike_index</span><span class="p">]</span>
                
                <span class="c1"># Get the dérivatives of the Zernike polynomial if requested</span>
                <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
                    <span class="n">Z_nm_dx</span> <span class="o">=</span> <span class="n">zernike_results</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">zernike_index</span><span class="p">]</span>
                    <span class="n">Z_nm_dy</span> <span class="o">=</span> <span class="n">zernike_results</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">zernike_index</span><span class="p">]</span>

                <span class="c1"># Extract the coefficients for the x and y coordinates</span>
                <span class="n">index_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
                <span class="n">Cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index_x</span><span class="p">]</span>
                <span class="n">index_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="n">Cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">index_y</span><span class="p">]</span>

                <span class="c1"># Update the distorted points</span>
                <span class="n">x_D</span> <span class="o">+=</span> <span class="n">Cx</span> <span class="o">*</span> <span class="n">Z_nm</span>
                <span class="n">y_D</span> <span class="o">+=</span> <span class="n">Cy</span> <span class="o">*</span> <span class="n">Z_nm</span>

                <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
                    <span class="c1"># Compute the Jacobian with respect to the normalized points</span>
                    <span class="n">jacobian_dx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Cx</span> <span class="o">*</span> <span class="n">Z_nm_dx</span>
                    <span class="n">jacobian_dx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Cx</span> <span class="o">*</span> <span class="n">Z_nm_dy</span>
                    <span class="n">jacobian_dx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Cy</span> <span class="o">*</span> <span class="n">Z_nm_dx</span>
                    <span class="n">jacobian_dx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Cy</span> <span class="o">*</span> <span class="n">Z_nm_dy</span>

                <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
                    <span class="c1"># Compute the Jacobian with respect to the distortion parameters</span>
                    <span class="n">jacobian_dp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z_nm</span>
                    <span class="n">jacobian_dp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">index_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">Z_nm</span>

        <span class="c1"># Convert the distorted points back to the original coordinates</span>
        <span class="n">distorted_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">normalized_points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">distorted_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_D</span>
        <span class="n">distorted_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_D</span>

        <span class="c1"># Return the distorted points and the jacobians if requested</span>
        <span class="k">return</span> <span class="n">distorted_points</span><span class="p">,</span> <span class="n">jacobian_dx</span><span class="p">,</span> <span class="n">jacobian_dp</span></div>

    

    
<div class="viewcode-block" id="ZernikeDistortion._inverse_transform">
<a class="viewcode-back" href="../../api_doc/zernike_distortion.html#pydistort.ZernikeDistortion._inverse_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_inverse_transform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distorted_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.objects.Transform.inverse_transform` method to perform the inverse distortion transformation.</span>
<span class="sd">        This method allows to transform the ``distorted_points`` back to the ``normalized_points`` using the distortion model.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_inverse_transform`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) for the normalized points and the jacobian are always None.</span>

<span class="sd">        See the :meth:`pydistort.objects.objetcs.Transform.optimize_input_points` method for more details.</span>
<span class="sd">        The initial guess is setted to :math:`\mathbf{x}_{N} = \mathbf{x}_{D} - U(\mathbf{x}_{D})``, where :math:`U(\mathbf{x}_{D})` is the distortion filed applied to the distorted points.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            Array of distorted points to be transformed back to normalized points with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            [Always False]</span>
<span class="sd">        </span>
<span class="sd">        dp : bool, optional</span>
<span class="sd">            [Always False]</span>

<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments to be passed to the optimization method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            The transformed normalized points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            [Always None]</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            [Always None]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="ow">or</span> <span class="n">dp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[WARNING]: Undistortion with dx=True or dp=True. The jacobians cannot be computed with this method. They are always None.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">normalized_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimize_input_points</span><span class="p">(</span>
            <span class="n">distorted_points</span><span class="p">,</span>
            <span class="n">guess</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distorted_points</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">distorted_points</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">_skip</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Skip the checks on the input points</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_points</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>
</div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025-%Y, Artezaru.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>