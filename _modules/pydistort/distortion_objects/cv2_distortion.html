
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pydistort.distortion_objects.cv2_distortion &#8212; pydistort 3.2.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=eb155f5e"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pydistort/distortion_objects/cv2_distortion';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pydistort 3.2.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pydistort.distortion_objects.cv2_distortion</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pydistort.distortion_objects.cv2_distortion</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Number</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..core.distortion</span><span class="w"> </span><span class="kn">import</span> <span class="n">Distortion</span>


<div class="viewcode-block" id="Cv2Distortion">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Cv2Distortion</span><span class="p">(</span><span class="n">Distortion</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of :class:`pydistort.core.Distortion` to represent the distortion transformation using OpenCV model.</span>

<span class="sd">    Distort the given ``normalized_points`` using the distortion model to obtain the ``distorted_points``.</span>

<span class="sd">    .. math::</span>

<span class="sd">        x_D = \text{distort}(x_N, \lambda_1, \lambda_2, \lambda_3, \ldots)</span>

<span class="sd">    The model of OpenCV is the following one:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{bmatrix}</span>
<span class="sd">        x_D \\</span>
<span class="sd">        y_D</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">        =</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">        x_N \frac{1+k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6} + 2p_1 x_N y_N + p_2 (r^2 + 2x_N^2) + s_1 r^2 + s_2 r^4 \\</span>
<span class="sd">        y_N \frac{1+k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6} + p_1 (r^2 + 2y_N^2) + 2p_2 x_N y_N + s_3 r^2 + s_4 r^4</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    </span>
<span class="sd">    where :math:`r^2 = x_N^2 + y_N^2` and :math:`k_i` are the radial distortion coefficients, :math:`p_i` are the tangential distortion coefficients and :math:`s_i` are the thin prism distortion coefficients.</span>

<span class="sd">    Then a perspective transformation is applied using :math:`\tau_x` and :math:`\tau_y` to obtain the final distorted points.</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{bmatrix}</span>
<span class="sd">        x_D \\</span>
<span class="sd">        y_D \\</span>
<span class="sd">        1</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">        =</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">        R_{33}(\tau) &amp; 0 &amp; -R_{13}(\tau) \\</span>
<span class="sd">        0 &amp; R_{33}(\tau) &amp; -R_{23}(\tau) \\</span>
<span class="sd">        0 &amp; 0 &amp; 1</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">        R(\tau)</span>
<span class="sd">        \begin{bmatrix}</span>
<span class="sd">        x_D \\</span>
<span class="sd">        y_D \\</span>
<span class="sd">        1</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    </span>
<span class="sd">    where :</span>

<span class="sd">    .. math::</span>

<span class="sd">        R(\tau) = \begin{bmatrix}</span>
<span class="sd">        cos(\tau_y) &amp; sin(\tau_x)sin(\tau_y) &amp; -cos(\tau_x)sin(\tau_y) \\</span>
<span class="sd">        0 &amp; cos(\tau_x) &amp; sin(\tau_x) \\</span>
<span class="sd">        sin(\tau_y) &amp; -sin(\tau_x)cos(\tau_y) &amp; cos(\tau_x)cos(\tau_y)</span>
<span class="sd">        \end{bmatrix}</span>
<span class="sd">    </span>
<span class="sd">    and :math:`R_{ij}(\tau)` are the elements of the rotation matrix.</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - https://docs.opencv.org/3.4/d9/d0c/group__calib3d.html for the OpenCV documentation</span>

<span class="sd">    OpenCV can use various models for distortion,</span>

<span class="sd">    - N = 4 parameters : :math:`(k_1, k_2, p_1, p_2)` : radial and tangential distortion</span>
<span class="sd">    - N = 5 parameters : :math:`(k_1, k_2, p_1, p_2, k_3)` : radial and tangential distortion with third order radial distortion</span>
<span class="sd">    - N = 8 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6)` : radial and tangential distortion with fractional radial distortion</span>
<span class="sd">    - N = 12 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6, s_1, s_2, s_3, s_4)` : radial and tangential distortion with thin prism distortion</span>
<span class="sd">    - N = 14 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6, s_1, s_2, s_3, s_4, \tau_x, \tau_y)` : radial and tangential distortion with thin prism distortion and perspective transformation</span>

<span class="sd">    If the number of input parameters is not equal to the number of parameters required by the model, the other parameters are set to 0.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        If the number of parameters ``Nparams`` is given during instantiation, the given parameters are truncated or extended to the given number of parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : numpy.ndarray, optional</span>
<span class="sd">        The parameters of the distortion model. If None, no distortion is applied. The default is None.</span>

<span class="sd">    Nparams : int, optional</span>
<span class="sd">        The number of parameters of the distortion model. If None, the number of parameters is set to the number of parameters of the model. The default is None.</span>
<span class="sd">        Must be in [0, 4, 5, 8, 12, 14] if given.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Create an distortion object with a given model:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        from pydistort import Cv2Distortion</span>

<span class="sd">        # Create a distortion object with 8 parameters</span>
<span class="sd">        distortion = Cv2Distortion(np.array([0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8])) # Model with 8 parameters</span>

<span class="sd">    Then you can use the distortion object to distort ``normalized_points``:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        normalized_points = np.array([[0.1, 0.2],</span>
<span class="sd">                                       [0.3, 0.4],</span>
<span class="sd">                                       [0.5, 0.6]]) # shape (3, 2)</span>

<span class="sd">        result = distortion.transform(normalized_points): #alias distort is also available</span>
<span class="sd">        distorted_points = result.distorted_points # shape (3, 2) -&gt; distorted points in (normalized) image coordinates</span>
<span class="sd">        print(distorted_points)</span>

<span class="sd">    You can also access to the jacobian of the distortion transformation:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        result = distortion.transform(distorted_points, dx=True, dp=True)</span>
<span class="sd">        distorted_points_dx = result.jacobian_dx  # Jacobian of the image points with respect to the distorted points # Shape (..., 2, 3)</span>
<span class="sd">        distorted_points_dp = result.jacobian_dp  # Jacobian of the image points with respect to the intrinsic parameters # Shape (..., 2, Nparams)</span>

<span class="sd">    The parameters are ordered as given in the model description above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">=</span> <span class="n">Nparams</span>

    <span class="c1"># =================================================================</span>
    <span class="c1"># Parameters</span>
    <span class="c1"># =================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the parameters of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            The parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the parameters of the distortion model.</span>
<span class="sd">        If None, no distortion is applied.</span>

<span class="sd">        The number of parameters should be 4, 5, 8, 12 or 14.</span>
<span class="sd">        If the number of input parameters is not equal to the number of parameters required by the model, the other parameters are set to 0.</span>

<span class="sd">        The parameters are set in the following order:</span>

<span class="sd">        - N = 0 parameters : similar than None</span>
<span class="sd">        - N = 4 parameters : :math:`(k_1, k_2, p_1, p_2)` : radial and tangential distortion</span>
<span class="sd">        - N = 5 parameters : :math:`(k_1, k_2, p_1, p_2, k_3)` : radial and tangential distortion with third order radial distortion</span>
<span class="sd">        - N = 8 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6)` : radial and tangential distortion with fractional radial distortion</span>
<span class="sd">        - N = 12 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6, s_1, s_2, s_3, s_4)` : radial and tangential distortion with thin prism distortion</span>
<span class="sd">        - N = 14 parameters : :math:`(k_1, k_2, p_1, p_2, k_3, k_4, k_5, k_6, s_1, s_2, s_3, s_4, \tau_x, \tau_y)` : radial and tangential distortion with thin prism distortion and perspective transformation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameters : numpy.ndarray, optional</span>
<span class="sd">            The parameters of the distortion model. If None, no distortion is applied. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the parameters is not a 1D numpy array.</span>
<span class="sd">            If more than 14 parameters are given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The parameters should be a 1D numpy array.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters of CV2 distortion should be less than or equal to 14.&quot;</span><span class="p">)</span>
            <span class="c1"># Extend the number of parameters to a valid number</span>
            <span class="n">valid_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">valid_sizes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">Nparams</span> <span class="o">=</span> <span class="n">valid_sizes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="c1"># Extend the parameters to the next valid size</span>
            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">parameters</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nparams</span> <span class="o">-</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span><span class="p">)))</span>
            <span class="c1"># Set to None if the number of parameters is 0</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nparams</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of parameters of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">size</span>
        
    <span class="nd">@Nparams</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Nparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Integral</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the number of parameters of the distortion model.</span>
<span class="sd">        </span>
<span class="sd">        The given number of parameters must be in [0, 4, 5, 8, 12, 14].</span>

<span class="sd">        If the given number of parameters is less than the current number of parameters, the parameters are truncated.</span>
<span class="sd">        If the given number of parameters is greater than the current number of parameters, the parameters are extended with zeros.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The number of parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The number of parameters should be an integer.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters should be in [0, 4, 5, 8, 12, 14].&quot;</span><span class="p">)</span>
        
        <span class="c1"># If parameters is None, create a new array of zeros</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># Update the number of parameters instead of creating a new array</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">)))</span>
    

    <span class="c1"># =================================================================</span>
    <span class="c1"># Distortion Model Coefficients</span>
    <span class="c1"># =================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The first radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before getting the k1 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@k1</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the first radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The first radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before setting the k1 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the second radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The second radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before getting the k2 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="nd">@k2</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the second radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The second radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before setting the k2 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first tangential distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The first tangential distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before getting the p1 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="nd">@p1</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the first tangential distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The first tangential distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before setting the p1 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the second tangential distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The second tangential distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before getting the p2 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    
    <span class="nd">@p2</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">p2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the second tangential distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 4.</span>
<span class="sd">            Set the number of parameters to 4 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The second tangential distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 4.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 4. Set the number of parameters to 4 or more before setting the p2 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the third radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 5.</span>
<span class="sd">            Set the number of parameters to 5 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The third radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 5.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 5. Set the number of parameters to 5 or more before getting the k3 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    
    <span class="nd">@k3</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the third radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 5.</span>
<span class="sd">            Set the number of parameters to 5 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The third radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 5.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 5. Set the number of parameters to 5 or more before setting the k3 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k4</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The first fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before getting the k4 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="nd">@k4</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the first fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The first fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before setting the k4 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k5</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the second fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The second fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before getting the k5 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    
    <span class="nd">@k5</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the second fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The second fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before setting the k5 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k6</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the third fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The third fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before getting the k6 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

    <span class="nd">@k6</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">k6</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the third fractional radial distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 8.</span>
<span class="sd">            Set the number of parameters to 8 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The third fractional radial distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 8.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 8. Set the number of parameters to 8 or more before setting the k6 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the first thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The first thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before getting the s1 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    
    <span class="nd">@s1</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the first thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The first thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before setting the s1 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the second thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The second thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before getting the s2 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
    
    <span class="nd">@s2</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the second thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The second thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before setting the s2 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the third thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The third thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before getting the s3 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    
    <span class="nd">@s3</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the third thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The third thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before setting the s3 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s4</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the fourth thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The fourth thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before getting the s4 value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
    
    <span class="nd">@s4</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">s4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the fourth thin prism distortion coefficient.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 12.</span>
<span class="sd">            Set the number of parameters to 12 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The fourth thin prism distortion coefficient.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 12.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 12. Set the number of parameters to 12 or more before setting the s4 value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tau_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the x component of the perspective transformation.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 14.</span>
<span class="sd">            Set the number of parameters to 14 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The x component of the perspective transformation.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 14.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 14. Set the number of parameters to 14 or more before getting the tau_x value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
    
    <span class="nd">@tau_x</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tau_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the x component of the perspective transformation.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 14.</span>
<span class="sd">            Set the number of parameters to 14 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The x component of the perspective transformation.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 14.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 14. Set the number of parameters to 14 or more before setting the tau_x value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tau_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the y component of the perspective transformation.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 14.</span>
<span class="sd">            Set the number of parameters to 14 or more before getting the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The y component of the perspective transformation.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 14.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span> 
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 14. Set the number of parameters to 14 or more before getting the tau_y value.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
    
    <span class="nd">@tau_y</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tau_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the y component of the perspective transformation.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            An error is raised if the number of parameters is less than 14.</span>
<span class="sd">            Set the number of parameters to 14 or more before setting the value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The y component of the perspective transformation.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of parameters is less than 14.</span>
<span class="sd">            If the value is not a number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The value should be a number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of parameters is less than 14. Set the number of parameters to 14 or more before setting the tau_y value.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
       

<div class="viewcode-block" id="Cv2Distortion.make_empty">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion.make_empty">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set to zero the parameters of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">,</span> <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>



    <span class="c1"># =================================================================</span>
    <span class="c1"># Internal methods to compute the distortion</span>
    <span class="c1"># =================================================================</span>
<div class="viewcode-block" id="Cv2Distortion._compute_tilt_matrix">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion._compute_tilt_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_tilt_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the tilt matrix for the perspective transformation for N = 14 (only).</span>

<span class="sd">        The tilt matrix is computed using the following equation:</span>

<span class="sd">        .. math::</span>

<span class="sd">            R_{\text{tilt}}{\tau} = R_Z[R_Y R_X] R_Y R_X</span>

<span class="sd">        where :math:`R_X` and :math:`R_Y` are the rotation matrices along X and Y respectively, and :math:`R_Z` is the rotation matrix along Z.</span>

<span class="sd">        .. math::</span>
<span class="sd">            R_X = \begin{pmatrix}</span>
<span class="sd">                1 &amp; 0 &amp; 0 \\</span>
<span class="sd">                0 &amp; \cos(\tau_x) &amp; \sin(\tau_x) \\</span>
<span class="sd">                0 &amp; -\sin(\tau_x) &amp; \cos(\tau_x)</span>
<span class="sd">            \end{pmatrix}</span>

<span class="sd">        .. math::</span>
<span class="sd">            R_Y = \begin{pmatrix}</span>
<span class="sd">                \cos(\tau_y) &amp; 0 &amp; -\sin(\tau_y) \\</span>
<span class="sd">                0 &amp; 1 &amp; 0 \\</span>
<span class="sd">                \sin(\tau_y) &amp; 0 &amp; \cos(\tau_y)</span>
<span class="sd">            \end{pmatrix}</span>

<span class="sd">        and we note that the rotation matrix along Z is given by:</span>

<span class="sd">        .. math::</span>

<span class="sd">            R_z[R] = \begin{pmatrix}</span>
<span class="sd">                R_{33} &amp; 0 &amp; -R_{13} \\</span>
<span class="sd">                0 &amp; R_{33} &amp; -R_{23} \\</span>
<span class="sd">                0 &amp; 0 &amp; 1</span>
<span class="sd">            \end{pmatrix}</span>

<span class="sd">        The derivatives of the tilt matrix with respect to :math:`\tau_x` and :math:`\tau_y` are also computed.</span>
<span class="sd">        The derivatives are computed using the following equations:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial R_{\text{tilt}}}{\partial \tau_x} = R_Z [R_Y \frac{\partial R_X}{\partial \tau_x}, 0] R_Y R_X + R_Z [R_Y R_X, 1] R_Y \frac{\partial R_X}{\partial \tau_x}</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>

<span class="sd">            \frac{\partial R_{\text{tilt}}}{\partial \tau_y} = R_Z [\frac{\partial R_Y}{\partial \tau_y} R_X, 0] R_Y R_X + R_Z [R_Y R_X, 1] \frac{\partial R_Y}{\partial \tau_y} R_X    </span>

<span class="sd">        Finnally, the inverse of the tilt matrix is computed using the following equation:</span>

<span class="sd">        .. math::</span>

<span class="sd">            R_{\text{tilt}}^{-1} = (Ry Rx).T @ invRz[Ry Rx]</span>

<span class="sd">        Where :math:`invRz` is the inverse of the rotation matrix along Z given by:</span>

<span class="sd">        .. math::</span>

<span class="sd">            (R_z[R])^{-1} = \begin{pmatrix}</span>
<span class="sd">                1/R_{33} &amp; 0 &amp; R_{13}/R_{33} \\</span>
<span class="sd">                0 &amp; 1/R_{33} &amp; R_{23}/R_{33} \\</span>
<span class="sd">                0 &amp; 0 &amp; 1</span>
<span class="sd">            \end{pmatrix}</span>

<span class="sd">        .. note:: </span>

<span class="sd">            If the model is not set to 14 parameters, the method returns a identity matrix and the derivatives are set to zero. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dp : bool, optional</span>
<span class="sd">            If True, the derivatives of the tilt matrix are computed. The default is True.</span>
<span class="sd">            If False, the derivatives are set to None.</span>

<span class="sd">        inv : bool, optional</span>
<span class="sd">            If True, the inverse of the tilt matrix is computed. The default is True.</span>
<span class="sd">            If False, the inverse of the tilt matrix is set to None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            The tilt matrix.</span>

<span class="sd">        numpy.ndarray</span>
<span class="sd">            The derivative of the tilt matrix with respect to :math:`\tau_x` if ``dp`` is True, else None.</span>

<span class="sd">        numpy.ndarray</span>
<span class="sd">            The derivative of the tilt matrix with respect to :math:`\tau_y` if ``dp`` is True, else None.</span>
<span class="sd">        </span>
<span class="sd">        numpy.ndarray</span>
<span class="sd">            The inverse of the tilt matrix if ``inv`` is True, else None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The dp parameter should be a boolean.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Initialize the rotation matrices</span>
        <span class="n">R</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Rdtx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Rdty</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">invR</span> <span class="o">=</span> <span class="kc">None</span>
    
        <span class="c1"># If the number of parameters is not 14, return identity matrix and zero derivatives</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">!=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
                <span class="n">Rdtx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">Rdty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inv</span><span class="p">:</span>
                <span class="n">invR</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">Rdtx</span><span class="p">,</span> <span class="n">Rdty</span><span class="p">,</span> <span class="n">invR</span>

        <span class="c1"># Prepare the cosinus and sinus of the angles</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_x</span><span class="p">)</span>
        <span class="n">cty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_y</span><span class="p">)</span>
        <span class="n">stx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_x</span><span class="p">)</span>
        <span class="n">sty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_y</span><span class="p">)</span>

        <span class="c1"># Prepare the rotation matrix along X and Y</span>
        <span class="n">Rx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">stx</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">stx</span><span class="p">,</span> <span class="n">ctx</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">Ry</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">cty</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sty</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">sty</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cty</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">Rxdtx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">stx</span><span class="p">,</span> <span class="n">ctx</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">ctx</span><span class="p">,</span> <span class="o">-</span><span class="n">stx</span><span class="p">]</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

            <span class="n">Rydty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="o">-</span><span class="n">sty</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cty</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">cty</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">sty</span><span class="p">]</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># Compute the products of the rotation matrices</span>
        <span class="n">Rxy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span> <span class="n">Rx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">Rxydtx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span> <span class="n">Rxdtx</span><span class="p">)</span>
            <span class="n">Rxydty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rydty</span><span class="p">,</span> <span class="n">Rx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inv</span><span class="p">:</span>
            <span class="n">invRxy</span> <span class="o">=</span> <span class="n">Rxy</span><span class="o">.</span><span class="n">T</span>
            
        <span class="c1"># Compute the rotation along Z</span>
        <span class="n">Rz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">Rzdtx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">Rxydtx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">Rxydtx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Rxydtx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">Rxydtx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

            <span class="n">Rzdty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">Rxydty</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">Rxydty</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Rxydty</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">Rxydty</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">inv</span><span class="p">:</span>
            <span class="n">invRz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Rxy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">Rxy</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Rxy</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># Compute the tilt matrix and the derivatives</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rz</span><span class="p">,</span> <span class="n">Rxy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">Rdtx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rz</span><span class="p">,</span> <span class="n">Rxydtx</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rzdtx</span><span class="p">,</span> <span class="n">Rxy</span><span class="p">)</span>
            <span class="n">Rdty</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rz</span><span class="p">,</span> <span class="n">Rxydty</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rzdty</span><span class="p">,</span> <span class="n">Rxy</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">inv</span><span class="p">:</span>
            <span class="n">invR</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Rxy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">invRz</span><span class="p">)</span>

        <span class="c1"># Return the tilt matrix and the derivatives</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">Rdtx</span><span class="p">,</span> <span class="n">Rdty</span><span class="p">,</span> <span class="n">invR</span></div>

    
    <span class="c1"># =================================================================</span>
    <span class="c1"># Display the distortion model</span>
    <span class="c1"># =================================================================</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string representation of the distortion model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The string representation of the distortion model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Cv2Distortion: No distortion model&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cv2Distortion: k1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="si">}</span><span class="s2">, p1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="si">}</span><span class="s2">, p2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cv2Distortion: k1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="si">}</span><span class="s2">, p1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="si">}</span><span class="s2">, p2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="si">}</span><span class="s2">, k3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k3</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cv2Distortion: k1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="si">}</span><span class="s2">, p1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="si">}</span><span class="s2">, p2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="si">}</span><span class="s2">, k3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k3</span><span class="si">}</span><span class="s2">, k4 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k4</span><span class="si">}</span><span class="s2">, k5 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k5</span><span class="si">}</span><span class="s2">, k6 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k6</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cv2Distortion: k1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="si">}</span><span class="s2">, p1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="si">}</span><span class="s2">, p2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="si">}</span><span class="s2">, k3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k3</span><span class="si">}</span><span class="s2">, k4 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k4</span><span class="si">}</span><span class="s2">, k5 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k5</span><span class="si">}</span><span class="s2">, k6 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k6</span><span class="si">}</span><span class="s2">, s1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="si">}</span><span class="s2">, s2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="si">}</span><span class="s2">, s3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="si">}</span><span class="s2">, s4 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s4</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Cv2Distortion: k1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="si">}</span><span class="s2">, k2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="si">}</span><span class="s2">, p1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="si">}</span><span class="s2">, p2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="si">}</span><span class="s2">, k3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k3</span><span class="si">}</span><span class="s2">, k4 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k4</span><span class="si">}</span><span class="s2">, k5 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k5</span><span class="si">}</span><span class="s2">, k6 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k6</span><span class="si">}</span><span class="s2">, s1 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="si">}</span><span class="s2">, s2 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="si">}</span><span class="s2">, s3 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="si">}</span><span class="s2">, s4 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">s4</span><span class="si">}</span><span class="s2">, tau_x = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_x</span><span class="si">}</span><span class="s2">, tau_y = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tau_y</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown distortion model with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="si">}</span><span class="s2"> parameters.&quot;</span><span class="p">)</span> 

    <span class="c1"># =================================================================</span>
    <span class="c1"># Implementation of the abstract methods</span>
    <span class="c1"># =================================================================</span>
<div class="viewcode-block" id="Cv2Distortion.is_set">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion.is_set">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the distortion model is set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the distortion model is set, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The distortion model is always set (Nparams = 0 just means no distortion)</span>
        <span class="k">return</span> <span class="kc">True</span> </div>

    
    
<div class="viewcode-block" id="Cv2Distortion._transform">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion._transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">opencv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.core.Transform.transform` method to perform the distortion transformation.</span>
<span class="sd">        This method allows to transform the ``normalized_points`` to the ``distorted_points`` using the distortion model.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_transform`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) for the image points and (Npoints, 2, 2) for the jacobian with respect to the normalized points and (Npoints, 2, 4) for the jacobian with respect to the distortion parameters.</span>

<span class="sd">        The equation used for the transformation is given in the main documentation of the class.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">        To achieve the distortion transformation using openCV, set the ``opencv`` parameter to True. (``jacobian_dx`` will not be computed in this case).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            Array of normalized points to be transformed with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            If True, the Jacobian of the distorted points with respect to the normalized points is computed. Default is False.</span>
<span class="sd">            The output will be a 2D array of shape (Npoints, 2, 2).</span>

<span class="sd">        dp : bool, optional</span>
<span class="sd">            If True, the Jacobian of the distorted points with respect to the distortion parameters is computed. Default is False.</span>
<span class="sd">            The output will be a 2D array of shape (Npoints, 2, Nparams).</span>
<span class="sd">        </span>
<span class="sd">        opencv : bool, optional</span>
<span class="sd">            If True, the distortion transformation is achieved using the OpenCV function ``projectPoints``.</span>
<span class="sd">            If False, the distortion transformation is achieved using the internal method.</span>
<span class="sd">            Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            The transformed distorted points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            The Jacobian of the distorted points with respect to the normalized points if ``dx`` is True. Otherwise None.</span>
<span class="sd">            It will be a 2D array of shape (Npoints, 2, 2).</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            The Jacobian of the distorted points with respect to the distortion parameters if ``dp`` is True. Otherwise None.</span>
<span class="sd">            It will be a 2D array of shape (Npoints, 2, Nparams).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># USE THE OPEN CV DISTORTION IF REQUESTED</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opencv</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The opencv parameter must be a boolean.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opencv</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_opencv</span><span class="p">(</span><span class="n">normalized_points</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dp</span><span class="o">=</span><span class="n">dp</span><span class="p">)</span>

        <span class="c1"># Prepare the inputs data for distortion</span>
        <span class="n">x_N</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">y_N</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">x_N</span> <span class="o">=</span> <span class="n">x_N</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_N</span> <span class="o">=</span> <span class="n">y_N</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">Npoints</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span>

        <span class="n">zero</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dim</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">dim</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, dim)</span>
        <span class="n">ccat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tup</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Concatenate along the second axis</span>
        <span class="n">dDdxy</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># The derivative of the distortion with respect to the normalized points</span>
        <span class="n">dDdp</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># The derivative of the distortion with respect to the distortion parameters</span>

        <span class="c1"># Prepare some variables for the distortion</span>
        <span class="n">xN_yN</span> <span class="o">=</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">y_N</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">xN2</span> <span class="o">=</span> <span class="n">x_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">yN2</span> <span class="o">=</span> <span class="n">y_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Npoints, 1)</span>
        
        <span class="c1"># Return a identity Jacobian and an empty jacobian if no parameters in the model</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">distorted_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">normalized_points</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>
            <span class="k">if</span> <span class="n">dx</span><span class="p">:</span> 
                <span class="n">dDdxy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2, 2)</span>
                <span class="n">dDdxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">dDdxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
                <span class="n">dDdp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2, 0)</span>
            <span class="k">return</span> <span class="n">distorted_points</span><span class="p">,</span> <span class="n">dDdxy</span><span class="p">,</span> <span class="n">dDdp</span>
                
        <span class="c1"># Prepare the powers of the norm (r) [only if needed] with shape (Npoints, 1)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">xN2</span> <span class="o">+</span> <span class="n">yN2</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">r4</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">r6</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Prepare the radial distortion coefficients [only if needed] with shape (Npoints, 1)</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="k">elif</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
        
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Nparams &gt;= 8</span>
            <span class="n">Kup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">Kdown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k4</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k5</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k6</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">iKdown</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Kdown</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">i2Kdown</span> <span class="o">=</span> <span class="n">iKdown</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">K</span> <span class="o">=</span> <span class="n">Kup</span> <span class="o">*</span> <span class="n">iKdown</span> <span class="c1"># shape (Npoints, 1)</span>
                            
        <span class="n">x_radial</span> <span class="o">=</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">K</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_radial</span> <span class="o">=</span> <span class="n">y_N</span> <span class="o">*</span> <span class="n">K</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Prepare the tangential distortion coefficients [only if needed] with shape (Npoints, 1)</span>
        <span class="n">axp1</span> <span class="o">=</span> <span class="n">ayp2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xN_yN</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">axp2</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xN2</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">ayp1</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">yN2</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">x_tangential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">*</span> <span class="n">axp1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">*</span> <span class="n">axp2</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_tangential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">*</span> <span class="n">ayp1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">*</span> <span class="n">ayp2</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Prepare the prism distortion coefficients [only if needed] with shape (Npoints, 1)</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">x_prism</span> <span class="o">=</span> <span class="n">zero</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_prism</span> <span class="o">=</span> <span class="n">zero</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Nparams &gt;= 12</span>
            <span class="n">x_prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Npoints, 1)</span>
            
        <span class="c1"># Compute the distorted points</span>
        <span class="n">x_D</span> <span class="o">=</span> <span class="n">x_radial</span> <span class="o">+</span> <span class="n">x_tangential</span> <span class="o">+</span> <span class="n">x_prism</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_D</span> <span class="o">=</span> <span class="n">y_radial</span> <span class="o">+</span> <span class="n">y_tangential</span> <span class="o">+</span> <span class="n">y_prism</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Prepare some variables for the jacobians</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dx</span> <span class="ow">and</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">xN_r2</span> <span class="o">=</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">r2</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">yN_r2</span> <span class="o">=</span> <span class="n">y_N</span> <span class="o">*</span> <span class="n">r2</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Compute the Jacobians with respect to the normalized points with shape (Npoints, 2)</span>
        <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
            <span class="n">x_Ddxy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>
            <span class="n">y_Ddxy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">dK_r2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="k">elif</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">dK_r2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dK_r2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Kdown</span> <span class="o">-</span> <span class="n">Kup</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k5</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k6</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1)</span>
                <span class="n">dK_r2</span> <span class="o">=</span> <span class="n">dK_r2</span> <span class="o">*</span> <span class="n">i2Kdown</span>

            <span class="n">x_radial_dx</span> <span class="o">=</span> <span class="n">K</span> <span class="o">+</span> <span class="n">dK_r2</span> <span class="o">*</span> <span class="n">xN2</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">x_radial_dy</span> <span class="o">=</span> <span class="n">y_radial_dx</span> <span class="o">=</span> <span class="n">dK_r2</span> <span class="o">*</span> <span class="n">xN_yN</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_radial_dy</span> <span class="o">=</span> <span class="n">K</span> <span class="o">+</span> <span class="n">dK_r2</span> <span class="o">*</span> <span class="n">yN2</span> <span class="c1"># shape (Npoints, 1)</span>

            <span class="n">x_tangential_dx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span>
            <span class="n">x_tangential_dy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span>
            <span class="n">y_tangential_dx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span>
            <span class="n">y_tangential_dy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span>

            <span class="n">x_Ddxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_radial_dx</span> <span class="o">+</span> <span class="n">x_tangential_dx</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">x_Ddxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_radial_dy</span> <span class="o">+</span> <span class="n">x_tangential_dy</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_radial_dx</span> <span class="o">+</span> <span class="n">y_tangential_dx</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_radial_dy</span> <span class="o">+</span> <span class="n">y_tangential_dy</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">x_Ddxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">*</span> <span class="n">xN_r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">x_Ddxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">*</span> <span class="n">yN_r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span><span class="p">)</span> <span class="o">*</span> <span class="n">xN_r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span><span class="p">)</span> <span class="o">*</span> <span class="n">yN_r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">x_Ddp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, Nparams)</span>
            <span class="n">y_Ddp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, Nparams)</span>

            <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xN_r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">xN_r2</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r4</span> <span class="o">*</span> <span class="n">x_N</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">r4</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">axp1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">axp2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddp</span><span class="p">[:</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yN_r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">yN_r2</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r4</span> <span class="o">*</span> <span class="n">y_N</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">r4</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ayp1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ayp2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r6</span> <span class="o">*</span> <span class="n">x_N</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">r6</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r6</span> <span class="o">*</span> <span class="n">y_N</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&lt;=</span> <span class="mi">5</span> <span class="k">else</span> <span class="p">(</span><span class="n">r6</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">*</span> <span class="n">iKdown</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">m_Kup_i2Kdown</span> <span class="o">=</span> <span class="o">-</span><span class="n">Kup</span> <span class="o">*</span> <span class="n">i2Kdown</span>
                <span class="n">m_Kup_i2Kdown_xN</span> <span class="o">=</span> <span class="n">m_Kup_i2Kdown</span> <span class="o">*</span> <span class="n">x_N</span>
                <span class="n">m_Kup_i2Kdown_yN</span> <span class="o">=</span> <span class="n">m_Kup_i2Kdown</span> <span class="o">*</span> <span class="n">y_N</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_xN</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_xN</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> 
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_xN</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_yN</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_yN</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> 
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_Kup_i2Kdown_yN</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">r4</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">r4</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
                <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>


        <span class="c1"># Apply the perspective transformation [only if needed]</span>
        <span class="c1"># Also compute the finals derivatives with respect to the normalized points and to the parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="c1"># Get the tilt matrix</span>
            <span class="n">R</span><span class="p">,</span> <span class="n">Rdtx</span><span class="p">,</span> <span class="n">Rdty</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tilt_matrix</span><span class="p">(</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dp</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># shape (3, 3) ; shape (3, 3) ; shape (3, 3)</span>

            <span class="c1"># Apply the perspective transformation</span>
            <span class="n">x_perspectD</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_perspectD</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">z_perspectD</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">iz_perspectD</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">z_perspectD</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">i2z_perspectD</span> <span class="o">=</span> <span class="n">iz_perspectD</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
                <span class="n">x_perspectDdxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddxy</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddxy</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>
                <span class="n">y_perspectDdxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddxy</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddxy</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>
                <span class="n">z_perspectDdxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddxy</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddxy</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
                <span class="n">x_perspectDdp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, Nparams)</span>
                <span class="n">x_perspectDdp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">])</span> <span class="c1"># shape (Npoints, 12)</span>
                <span class="n">x_perspectDdp</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdtx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
                <span class="n">x_perspectDdp</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdty</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>

                <span class="n">y_perspectDdp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, Nparams)</span>
                <span class="n">y_perspectDdp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">])</span> <span class="c1"># shape (Npoints, 12)</span>
                <span class="n">y_perspectDdp</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdtx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
                <span class="n">y_perspectDdp</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdty</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>

                <span class="n">z_perspectDdp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, Nparams)</span>
                <span class="n">z_perspectDdp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">+</span> <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_Ddp</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">12</span><span class="p">])</span> <span class="c1"># shape (Npoints, 12)</span>
                <span class="n">z_perspectDdp</span><span class="p">[:,</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdtx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdtx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
                <span class="n">z_perspectDdp</span><span class="p">[:,</span> <span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rdty</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">y_D</span> <span class="o">+</span> <span class="n">Rdty</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
            
            <span class="c1"># Normalize the points by the perspective transformation</span>
            <span class="n">x_D</span> <span class="o">=</span> <span class="n">x_perspectD</span> <span class="o">*</span> <span class="n">iz_perspectD</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_D</span> <span class="o">=</span> <span class="n">y_perspectD</span> <span class="o">*</span> <span class="n">iz_perspectD</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
                <span class="n">x_Ddxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_perspectDdxy</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">z_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">x_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">z_perspectDdxy</span><span class="p">)</span> <span class="o">*</span> <span class="n">i2z_perspectD</span> <span class="c1"># shape (Npoints, 2)</span>
                <span class="n">y_Ddxy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_perspectDdxy</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">z_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">y_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">z_perspectDdxy</span><span class="p">)</span> <span class="o">*</span> <span class="n">i2z_perspectD</span> <span class="c1"># shape (Npoints, 2)</span>
            <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
                <span class="n">x_Ddp</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_perspectDdp</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">z_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">))</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">x_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">))</span> <span class="o">*</span> <span class="n">z_perspectDdp</span><span class="p">)</span> <span class="o">*</span> <span class="n">i2z_perspectD</span> <span class="c1"># shape (Npoints, Nparams)</span>
                <span class="n">y_Ddp</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_perspectDdp</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">z_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">))</span> <span class="o">-</span> <span class="n">numpy</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">y_perspectD</span><span class="p">,</span> <span class="p">(</span><span class="n">Npoints</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">))</span> <span class="o">*</span> <span class="n">z_perspectDdp</span><span class="p">)</span> <span class="o">*</span> <span class="n">i2z_perspectD</span> <span class="c1"># shape (Npoints, Nparams)</span>
            
        <span class="c1"># Construct the final outputs</span>
        <span class="n">distorted_points</span> <span class="o">=</span> <span class="n">ccat</span><span class="p">((</span><span class="n">x_D</span><span class="p">,</span> <span class="n">y_D</span><span class="p">))</span> <span class="c1"># shape (Npoints, 2)</span>
        <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
            <span class="n">dDdxy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2, 2)</span>
            <span class="n">dDdxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x_Ddxy</span> <span class="c1"># shape (Npoints, 2)</span>
            <span class="n">dDdxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">y_Ddxy</span> <span class="c1"># shape (Npoints, 2)</span>
        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">dDdp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2, Nparams)</span>
            <span class="n">dDdp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x_Ddp</span> <span class="c1"># shape (Npoints, Nparams)</span>
            <span class="n">dDdp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">y_Ddp</span> <span class="c1"># shape (Npoints, Nparams)</span>
        
        <span class="c1"># Return the distorted points and the derivatives</span>
        <span class="k">return</span> <span class="n">distorted_points</span><span class="p">,</span> <span class="n">dDdxy</span><span class="p">,</span> <span class="n">dDdp</span></div>

    

<div class="viewcode-block" id="Cv2Distortion._transform_opencv">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion._transform_opencv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transform_opencv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.core.Transform.transform` method to perform the distortion transformation using OpenCV ``projectPoints`` function.</span>
<span class="sd">        To use this method, set the ``opencv`` parameter to True in the :meth:`pydistort.core.Transform.transform` method.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_transform_opencv`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) for the image points and (Npoints, 2, Nparams) for the jacobian with respect to the distortion parameters.</span>

<span class="sd">        The equation used for the transformation is given in the main documentation of the class.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">            The jacobian with respect to the normalized points is not computed in this case (always None).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            Array of normalized points to be transformed with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            [ALWAYS False]</span>

<span class="sd">        dp : bool, optional</span>
<span class="sd">            If True, the Jacobian of the distorted points with respect to the distortion parameters is computed. Default is False.</span>
<span class="sd">            The output will be a 2D array of shape (Npoints, 2, Nparams).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            The transformed distorted points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            [ALWAYS None]</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            The Jacobian of the distorted points with respect to the distortion parameters if ``dp`` is True. Otherwise None.</span>
<span class="sd">            It will be a 2D array of shape (Npoints, 2, Nparams).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dx</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[WARNING]: Distortion with Opencv and dx=True. The jacobian wrt normalized poits cannot be computed with this method. They are always None.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">Npoints</span> <span class="o">=</span> <span class="n">normalized_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Npoints </span>

        <span class="c1"># Create the contiguous array of shape (Npoints, 1, 3) for cv2 compatibility</span>
        <span class="n">object_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">normalized_points</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">normalized_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">object_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">object_points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># Apply the OpenCV distortion removing rvec, tvec and intrinsic matrix</span>
        <span class="n">rvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">tvec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">image_points</span><span class="p">,</span> <span class="n">jacobian</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">projectPoints</span><span class="p">(</span><span class="n">object_points</span><span class="p">,</span> <span class="n">rvec</span><span class="p">,</span> <span class="n">tvec</span><span class="p">,</span> <span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1, 2)</span>

        <span class="c1"># Reshape the image points to (2, Npoints)</span>
        <span class="n">distorted_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
            <span class="n">jacobian</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)[:,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">:]</span> <span class="c1"># shape (2 * Npoints, Nparams)</span>
            <span class="n">jacobian_dp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2, Nparams)</span>
            <span class="n">jacobian_dp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="c1"># shape (Npoints, Nparams)</span>
            <span class="n">jacobian_dp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="c1"># shape (Npoints, Nparams)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jacobian_dp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">distorted_points</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">jacobian_dp</span></div>

    


<div class="viewcode-block" id="Cv2Distortion._inverse_transform">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion._inverse_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_inverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distorted_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">opencv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.core.Transform.inverse_transform` method to perform the inverse distortion transformation.</span>
<span class="sd">        This method allows to transform the ``distorted_points`` to the ``normalized_points`` using the distortion model.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_inverse_transform`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) and the jacobian are always None.</span>

<span class="sd">        To achieve the undistortion, an iterative algorithm is used to find the normalized points that correspond to the distorted points.</span>
<span class="sd">        The algorithm is based on the following equations:</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            x_N [\text{it }k+1]\\</span>
<span class="sd">            y_N [\text{it }k+1]</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">            = </span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            (x_D - \Delta x [\text{it }k]) / \text{Rad} [\text{it }k] \\</span>
<span class="sd">            (y_D - \Delta y [\text{it }k]) / \text{Rad}[\text{it }k]</span>
<span class="sd">            \end{bmatrix}</span>

<span class="sd">        Where :math:`\Delta x [\text{it }k]` and :math:\Delta y [\text{it }k] are the tangential and prism distortion contributions to the distorted points computed at iteration :math:k.</span>
<span class="sd">        And :math:`\text{Rad} [\text{it }k]` is the radial distortion contribution to the distorted points computed at iteration :math:k.</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            \Delta x</span>
<span class="sd">            \Delta y</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">            =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            2 p_1 x_N y_N + p_2 (r^2 + 2x_N^2) + s_1 r^2 + s_2 r^4 \\</span>
<span class="sd">            2 p_2 x_N y_N + p_1 (r^2 + 2y_N^2) + s_3 r^2 + s_4 r^4</span>
<span class="sd">            \end{bmatrix}</span>

<span class="sd">        .. math::</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            \text{Rad}_x \\</span>
<span class="sd">            \text{Rad}_y</span>
<span class="sd">            \end{bmatrix}</span>
<span class="sd">            =</span>
<span class="sd">            \begin{bmatrix}</span>
<span class="sd">            \frac{1+k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6} \\</span>
<span class="sd">            \frac{1+k_1 r^2 + k_2 r^4 + k_3 r^6}{1 + k_4 r^2 + k_5 r^4 + k_6 r^6}</span>
<span class="sd">            \end{bmatrix}</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">        To achieve the inverse distortion transformation using openCV, set the ``opencv`` parameter to True. </span>

<span class="sd">        .. warning::</span>

<span class="sd">            Both OpenCV and the internal method use an iterative algorithm to find the normalized points that correspond to the distorted points.</span>
<span class="sd">            In fact the jacobian with respect to the normalized points is not computed for this inverse transform (always None).</span>

<span class="sd">        .. note::</span>

<span class="sd">            This method is not as optimized as the parent method :meth:`pydistort.core.Transform.optimized_input_points`.</span>
<span class="sd">            This implementation is provided to fit the zero-order approximation of OpenCV&#39;s undistortion function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            Array of distorted points to be transformed with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            [ALWAYS False]</span>

<span class="sd">        dp : bool, optional</span>
<span class="sd">            [ALWAYS False]</span>

<span class="sd">        opencv : bool, optional</span>
<span class="sd">            If True, the inverse distortion transformation is achieved using the OpenCV function ``undistortPoints``.</span>
<span class="sd">            If False, the inverse distortion transformation is achieved using the internal method.</span>
<span class="sd">            Default is False.</span>

<span class="sd">        max_iter : int, optional</span>
<span class="sd">            The maximum number of iterations for the optimization algorithm. Default is 10.</span>
<span class="sd">            Use only if ``opencv`` is False.</span>

<span class="sd">        eps : float, optional</span>
<span class="sd">            The tolerance for the optimization algorithm. Default is 1e-8.</span>
<span class="sd">            Use only if ``opencv`` is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            The transformed normalized points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            [ALWAYS None]</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            [ALWAYS None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># USE THE OPEN CV DISTORTION IF REQUESTED</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opencv</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The opencv parameter must be a boolean.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opencv</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverse_transform_opencv</span><span class="p">(</span><span class="n">distorted_points</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dp</span><span class="o">=</span><span class="n">dp</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">dx</span> <span class="ow">or</span> <span class="n">dp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[WARNING]: Undistortion with dx=True or dp=True. The jacobians cannot be computed with this method. They are always None.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare the inputs data for undistortion</span>
        <span class="n">x_D</span> <span class="o">=</span> <span class="n">distorted_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">y_D</span> <span class="o">=</span> <span class="n">distorted_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># shape (Npoints,)</span>
        <span class="n">x_D</span> <span class="o">=</span> <span class="n">x_D</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_D</span> <span class="o">=</span> <span class="n">y_D</span><span class="p">[:,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">Npoints</span> <span class="o">=</span> <span class="n">distorted_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span>

        <span class="c1"># Case of no parameters in the model</span>
        <span class="k">if</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">normalized_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">distorted_points</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">normalized_points</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Get the tilt matrix [only if needed]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="n">R</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">invR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tilt_matrix</span><span class="p">(</span><span class="n">dp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Prepare the output array:</span>
        <span class="n">normalized_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Npoints, 2)</span>

        <span class="c1"># Create the mask for the points in computation</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Npoints</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span> <span class="c1"># shape (Npoints,)</span>

        <span class="c1"># Remove the perspective transformation [only if needed]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">:</span>
            <span class="n">x_0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">invR</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">invR</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">z_0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">invR</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_D</span><span class="p">)</span> <span class="o">+</span> <span class="n">invR</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">x_0</span> <span class="o">=</span> <span class="n">x_0</span> <span class="o">/</span> <span class="n">z_0</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_0</span> <span class="o">=</span> <span class="n">y_0</span> <span class="o">/</span> <span class="n">z_0</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_0</span> <span class="o">=</span> <span class="n">x_D</span> <span class="c1"># shape (Npoints, 1)</span>
            <span class="n">y_0</span> <span class="o">=</span> <span class="n">y_D</span> <span class="c1"># shape (Npoints, 1)</span>

        <span class="c1"># Initialize the guess for the normalized points</span>
        <span class="n">x_N</span> <span class="o">=</span> <span class="n">x_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">y_N</span> <span class="o">=</span> <span class="n">y_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># shape (Npoints, 1)</span>
        <span class="n">Nopt</span> <span class="o">=</span> <span class="n">Npoints</span> <span class="c1"># Number of points in computation</span>

        <span class="c1"># Run the iterative algorithm</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>

            <span class="c1"># Prepare the powers of the norm (r) [only if needed] with shape (Nopt, 1)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">x_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">r4</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">r6</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="c1"># Prepare the radial distortion coefficients [only if needed] with shape (Nopt, 1)</span>
            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">invK</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="k">elif</span> <span class="n">Nparams</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">invK</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>
            
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Nparams &gt;= 8</span>
                <span class="n">Kup</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k3</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>
                <span class="n">Kdown</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k4</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k5</span> <span class="o">*</span> <span class="n">r4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k6</span> <span class="o">*</span> <span class="n">r6</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>
                <span class="n">invK</span> <span class="o">=</span> <span class="n">Kdown</span> <span class="o">/</span> <span class="n">Kup</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="c1"># Prepare the tangential distortion coefficients [only if needed] with shape (Nopt, 1)</span>
            <span class="n">axp1</span> <span class="o">=</span> <span class="n">ayp2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">*</span> <span class="n">y_N</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">axp2</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">ayp1</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">x_tangential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">*</span> <span class="n">axp1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">*</span> <span class="n">axp2</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">y_tangential</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">*</span> <span class="n">ayp1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">*</span> <span class="n">ayp2</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="c1"># Prepare the prism distortion coefficients [only if needed] with shape (Nopt, 1)</span>
            <span class="n">x_prism</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nopt</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">y_prism</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nopt</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="k">if</span> <span class="n">Nparams</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">x_prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Nopt, 1)</span>
                <span class="n">y_prism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">s4</span> <span class="o">*</span> <span class="n">r4</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="c1"># Update the normalized points</span>
            <span class="n">x_N</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_0</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">x_tangential</span> <span class="o">-</span> <span class="n">x_prism</span><span class="p">)</span> <span class="o">*</span> <span class="n">invK</span> <span class="c1"># shape (Nopt, 1)</span>
            <span class="n">y_N</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_0</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">y_tangential</span> <span class="o">-</span> <span class="n">y_prism</span><span class="p">)</span> <span class="o">*</span> <span class="n">invK</span> <span class="c1"># shape (Nopt, 1)</span>

            <span class="c1"># Update the normalized points</span>
            <span class="n">normalized_points</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_N</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Nopt,)</span>
            <span class="n">normalized_points</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_N</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="c1"># shape (Nopt,)</span>

            <span class="c1"># Distortion convergence check</span>
            <span class="n">distorted_points_optimized</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_N</span><span class="p">,</span> <span class="n">y_N</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># shape (Nopt, 2)</span>

            <span class="c1"># Compute the norm of the difference</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">distorted_points_optimized</span> <span class="o">-</span> <span class="n">distorted_points</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># shape (Nopt,)</span>
            <span class="n">eps_mask</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">eps</span> <span class="c1"># shape (Nopt,)</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">eps_mask</span><span class="p">)</span>

            <span class="c1"># Crop the X_N and Y_N arrays</span>
            <span class="n">Nopt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Nopt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">x_N</span> <span class="o">=</span> <span class="n">x_N</span><span class="p">[</span><span class="n">eps_mask</span><span class="p">]</span> <span class="c1"># shape (NewNopt, 1)</span>
            <span class="n">y_N</span> <span class="o">=</span> <span class="n">y_N</span><span class="p">[</span><span class="n">eps_mask</span><span class="p">]</span> <span class="c1"># shape (NewNopt, 1)</span>

        <span class="c1"># Return the normalized points</span>
        <span class="k">return</span> <span class="n">normalized_points</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Cv2Distortion._inverse_transform_opencv">
<a class="viewcode-back" href="../../../api_doc/cv2_distortion.html#pydistort.Cv2Distortion._inverse_transform_opencv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_inverse_transform_opencv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distorted_points</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the :meth:`pydistort.core.Transform.inverse_transform` method to perform the inverse distortion transformation using OpenCV ``undistortPoints`` function.</span>
<span class="sd">        To use this method, set the ``opencv`` parameter to True in the :meth:`pydistort.core.Transform.inverse_transform` method.</span>

<span class="sd">        .. note::</span>

<span class="sd">            For ``_inverse_transform_opencv`` the input must have shape (Npoints, 2) with float64 type.</span>
<span class="sd">            The output has shape (Npoints, 2) and the jacobian are always None.</span>

<span class="sd">        The equation used for the transformation is given in the main documentation of the class.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method is not designed to be used directly for the transformation of points.</span>
<span class="sd">            No checks are performed on the input points, so it is the user&#39;s responsibility to ensure that the input points are valid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distorted_points : numpy.ndarray</span>
<span class="sd">            Array of distorted points to be transformed with shape (Npoints, 2).</span>

<span class="sd">        dx : bool, optional</span>
<span class="sd">            [ALWAYS False]</span>

<span class="sd">        dp : bool, optional</span>
<span class="sd">            [ALWAYS False]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        normalized_points : numpy.ndarray</span>
<span class="sd">            The transformed normalized points in normalized coordinates. It will be a 2D array of shape (Npoints, 2).</span>

<span class="sd">        jacobian_dx : Optional[numpy.ndarray]</span>
<span class="sd">            [ALWAYS None]</span>

<span class="sd">        jacobian_dp : Optional[numpy.ndarray]</span>
<span class="sd">            [ALWAYS None]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="ow">or</span> <span class="n">dp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[WARNING]: Undistortion with OpenCV and dx=True or dp=True. The jacobians cannot be computed with this method. They are always None.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create the contiguous array of shape (Npoints, 1, 2) for cv2 compatibility</span>
        <span class="n">distorted_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">distorted_points</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># Apply the OpenCV undistortion removing rvec, tvec and intrinsic matrix</span>
        <span class="n">Rmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">Pmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">intrinsic_matrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">normalized_points</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">undistortPoints</span><span class="p">(</span><span class="n">distorted_points</span><span class="p">,</span> <span class="n">intrinsic_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">Rmat</span><span class="p">,</span> <span class="n">Pmat</span><span class="p">)</span> <span class="c1"># shape (Npoints, 1, 2)</span>

        <span class="c1"># Reshape the normalized points to (Npoints, 2)</span>
        <span class="n">normalized_points</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">normalized_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># Return the normalized points and the jacobian</span>
        <span class="k">return</span> <span class="n">normalized_points</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>
</div>



</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2025-%Y, Artezaru.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>